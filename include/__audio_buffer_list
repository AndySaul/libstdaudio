// libstdaudio
// Copyright (c) 2018 - Timur Doumler
// Distributed under the Boost Software License, Version 1.0.
// (See accompanying file LICENSE.md or copy at http://boost.org/LICENSE_1_0.txt)

#pragma once
#include <vector>
#include <__audio_config>
#include <__audio_buffer>

_LIBSTDAUDIO_NAMESPACE_BEGIN

/** A container holding a number of audio buffers for input and output, respectively. */
class buffer_list {
public:
  using size_type = size_t;

  /** Constructs an empty buffer list. */
  buffer_list();

  /** Constructs a buffer list with the specified number of buffers.
   *
   *  \param num_input_buffers The number of input buffers to hold.
   *  \param num_output_buffers The number of output buffers to hold.
   */
  buffer_list(size_type num_input_buffers, size_type num_output_buffers);

  /** Resizes the buffer list to contain the specified number of buffers.
   *
   *  \param num_input_buffers The number of input buffers to hold.
   *  \param num_output_buffers The number of output buffers to hold.
   */
  void resize(size_type num_input_buffers, size_type num_output_buffers);

  /** Returns: A ​span​ containing zero or more buffers of audio data
   *  that has been generated by the device.
   */
  span<buffer> input_buffers();

  /** Returns: A ​span​ containing zero or more buffers of audio data
   *  that the device has requested to be filled.
   */
  span<buffer> output_buffers();

  size_t __input_buffer_capacity() const noexcept;
  size_t __output_buffer_capacity() const noexcept;

private:
  vector<buffer> _input_buffers;
  vector<buffer> _output_buffers;

  // Maximum number of input and output buffers, respectively, that the buffer_list
  // is always guaranteed to be able to hold without reallocating.
  static constexpr size_t _safe_num_buffers = 10;
  void _preallocate_safe_num_buffers();
};

_LIBSTDAUDIO_NAMESPACE_END